<project name="CFUnited (p): ScriptDef" basedir="." default="play">

	<target name="init">

		<property name="libdir" location="lib" />
		<path id="ac.classpath">
			<fileset dir="${libdir}">
				<include name="**/*.jar" />
			</fileset>
		</path>
		<!-- http://sourceforge.net/projects/ant-contrib -->
		<taskdef resource="net/sf/antcontrib/antlib.xml" classpathref="ac.classpath" />
	</target>


	<target name="play" depends="init">
		<listGetAt list="one,two,three" pos="1" delim="," prop="myprop" />
		<echo message="${myprop}" />

		<listGetAt list="one,two,three" pos="2" delim="," prop="myprop" />
		<echo message="${myprop}" />
	</target>

	<target name="nestedLoops" depends="init">
		<property name="serverlist" value="1,10.0.205.59;2,10.0.205.69" />
		<echo message="${serverlist}" />
		<!-- loop over the serverlist -->
		<for list="${serverlist}" param="serverrow" delimiter=";">
			<sequential>
				<listGetAt list="@{serverrow}" pos="1" delim="," prop="serverid" />
				<listGetAt list="@{serverrow}" pos="2" delim="," prop="serverip" /> 
				<echo>${serverid} = ${serverip}</echo>
			</sequential>
		</for>
	</target>


	<scriptdef name="listGetAt" language="javascript">
		<attribute name="list" />
		<attribute name="pos" />
		<attribute name="delim" />
		<attribute name="prop" />		
			values = attributes.get("list").split(attributes.get("delim"));
			myint = parseInt(attributes.get("pos"));
			oneBasedIndex = myint-1; /* so if they pass position "1", we turn that into "0" since javascript is 0-based but we want to work in a 1-based fashion  */
			project.setProperty(attributes.get("prop"),values[oneBasedIndex]);	         
	</scriptdef>
</project>